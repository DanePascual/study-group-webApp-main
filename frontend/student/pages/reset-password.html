<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.0/font/bootstrap-icons.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../styles/reset-password.css" />
    <title>Reset Password - Study Group</title>
  </head>
  <body>
    <div class="main-container">
      <!-- Progress Indicator -->
      <div class="progress-container">
        <div class="progress-step active" id="progressStep1">
          <div class="step-number">1</div>
          <div class="step-label">Verify Link</div>
        </div>
        <div class="progress-line"></div>
        <div class="progress-step" id="progressStep2">
          <div class="step-number">2</div>
          <div class="step-label">New Password</div>
        </div>
        <div class="progress-line"></div>
        <div class="progress-step" id="progressStep3">
          <div class="step-number">3</div>
          <div class="step-label">Success</div>
        </div>
      </div>

      <!-- Reset Form (Step 1 & 2) -->
      <div class="reset-card" id="resetForm" style="display: none">
        <!-- Left Section -->
        <div class="left-section">
          <div class="left-content">
            <div class="reset-icon">
              <i class="bi bi-shield-lock"></i>
            </div>
            <div class="welcome-title">Secure Your Account</div>
            <div class="welcome-subtitle">
              Set a strong password to protect your StudyGroup account
            </div>

            <div class="login-section">
              <div class="login-text">Remember your password?</div>
              <button class="login-btn" onclick="goToLogin()">
                <i class="bi bi-arrow-left"></i> Back to Login
              </button>
            </div>
          </div>
        </div>

        <!-- Right Section -->
        <div class="right-section">
          <!-- Email Display -->
          <div class="email-display" id="emailDisplay" style="display: none">
            <div class="email-icon">
              <i class="bi bi-envelope-check"></i>
            </div>
            <div class="email-content">
              <div class="email-label">Resetting password for:</div>
              <div class="email-value" id="resetEmail">Loading...</div>
            </div>
          </div>

          <!-- Error Alert -->
          <div
            id="formError"
            role="alert"
            aria-live="assertive"
            class="alert-box error-alert"
            style="display: none"
          >
            <div class="alert-icon">
              <i class="bi bi-exclamation-circle-fill"></i>
            </div>
            <div class="alert-content">
              <div class="alert-message" id="formErrorMessage"></div>
            </div>
          </div>

          <!-- Password Form -->
          <form id="resetPasswordForm">
            <!-- New Password -->
            <div class="form-group">
              <label class="form-label">
                <i class="bi bi-lock"></i> New Password
              </label>
              <div class="input-wrapper">
                <input
                  type="password"
                  class="form-input"
                  id="newPassword"
                  placeholder="Create a strong password"
                  required
                  minlength="8"
                />
                <button
                  type="button"
                  class="password-toggle"
                  id="toggleNewPassword"
                  aria-label="Toggle password visibility"
                >
                  <i class="bi bi-eye"></i>
                </button>
              </div>

              <!-- Password Strength Indicator -->
              <div class="strength-section">
                <div class="strength-bar-container">
                  <div class="strength-bar" id="passwordStrengthBar"></div>
                </div>
                <div class="strength-info">
                  <span class="strength-label">Strength:</span>
                  <span class="strength-value" id="strengthValue">-</span>
                </div>
              </div>

              <!-- Requirements Checklist -->
              <div class="requirements-section">
                <div class="requirements-title">Password Requirements:</div>
                <div class="requirements-grid">
                  <div class="requirement-item" id="req-length">
                    <i class="bi bi-circle"></i>
                    <span>At least 8 characters</span>
                  </div>
                  <div class="requirement-item" id="req-uppercase">
                    <i class="bi bi-circle"></i>
                    <span>Uppercase letter (A-Z)</span>
                  </div>
                  <div class="requirement-item" id="req-lowercase">
                    <i class="bi bi-circle"></i>
                    <span>Lowercase letter (a-z)</span>
                  </div>
                  <div class="requirement-item" id="req-number">
                    <i class="bi bi-circle"></i>
                    <span>Number (0-9)</span>
                  </div>
                  <div class="requirement-item" id="req-special">
                    <i class="bi bi-circle"></i>
                    <span>Special character (!@#$)</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Confirm Password -->
            <div class="form-group">
              <label class="form-label">
                <i class="bi bi-lock-fill"></i> Confirm Password
              </label>
              <div class="input-wrapper">
                <input
                  type="password"
                  class="form-input"
                  id="confirmPassword"
                  placeholder="Re-enter your password"
                  required
                />
                <button
                  type="button"
                  class="password-toggle"
                  id="toggleConfirmPassword"
                  aria-label="Toggle password visibility"
                >
                  <i class="bi bi-eye"></i>
                </button>
              </div>
              <div class="match-feedback" id="matchFeedback"></div>
            </div>

            <!-- Security Tips -->
            <div class="security-tips">
              <h4><i class="bi bi-lightbulb"></i> Password Tips</h4>
              <ul>
                <li>Use a mix of uppercase, lowercase, numbers, and symbols</li>
                <li>Avoid personal information or common words</li>
                <li>Never reuse passwords from other accounts</li>
                <li>Try a passphrase: "MyDog@Barks2024!"</li>
              </ul>
            </div>

            <!-- Submit Button -->
            <button type="submit" class="reset-btn" id="resetBtn">
              <span class="btn-content">
                <i class="bi bi-check btn-icon"></i>
                <span id="btnText">Reset Password</span>
              </span>
              <span class="btn-loader" id="loadingSpinner">
                <i class="bi bi-arrow-repeat spinning"></i>
              </span>
            </button>
          </form>
        </div>
      </div>

      <!-- Error State -->
      <div class="status-card error-card" id="errorState" style="display: none">
        <div class="status-icon error">
          <i class="bi bi-exclamation-triangle-fill"></i>
        </div>
        <h2 class="status-title">Invalid or Expired Link</h2>
        <p class="status-message" id="errorMessage">
          This password reset link is invalid or has expired. Please request a
          new password reset link to continue.
        </p>
        <a href="login.html" class="status-btn">
          <i class="bi bi-arrow-left"></i>
          Back to Login
        </a>
      </div>

      <!-- Success State -->
      <div
        class="status-card success-card"
        id="successState"
        style="display: none"
      >
        <div class="status-icon success">
          <i class="bi bi-check-circle-fill"></i>
        </div>
        <h2 class="status-title">Password Reset Successful!</h2>
        <p class="status-message">
          Your password has been successfully updated. You can now sign in with
          your new password.
        </p>
        <div class="success-details">
          <div class="detail-item">
            <i class="bi bi-shield-check"></i>
            <span>Your account is secure</span>
          </div>
          <div class="detail-item">
            <i class="bi bi-clock-history"></i>
            <span>This session has ended for security</span>
          </div>
          <div class="detail-item">
            <i class="bi bi-key"></i>
            <span>Sign in with your new password</span>
          </div>
        </div>
        <a href="login.html" class="status-btn">
          <i class="bi bi-box-arrow-in-right"></i>
          Sign In Now
        </a>
      </div>
    </div>

    <!-- Confirmation Dialog -->
    <div
      id="confirmationDialog"
      class="confirmation-dialog"
      style="display: none"
    >
      <div class="confirmation-overlay"></div>
      <div class="confirmation-modal">
        <div class="confirmation-header"></div>
        <div class="confirmation-body">
          <p>Reset your password? You'll need to sign in again.</p>
        </div>
        <div class="confirmation-actions">
          <button class="btn-cancel" id="confirmCancel">Cancel</button>
          <button class="btn-confirm" id="confirmYes">OK</button>
        </div>
      </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script type="module" src="../scripts/reset-password.js"></script>
  </body>
</html>
