<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Bootstrap and icons -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.0/font/bootstrap-icons.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../styles/report.css" />
    <title>My Reports - Study Group</title>
  </head>
  <body>
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-brand">
          <i class="bi bi-book"></i>
          StudyGroup
        </div>
      </div>
      <nav class="sidebar-menu" role="navigation">
        <a href="dashboard.html" class="sidebar-item">
          <i class="bi bi-house"></i>
          <span>Dashboard</span>
        </a>
        <a href="profile.html" class="sidebar-item">
          <i class="bi bi-person"></i>
          <span>Profile</span>
        </a>
        <a href="study-rooms.html" class="sidebar-item">
          <i class="bi bi-door-open"></i>
          <span>Study Rooms</span>
        </a>
        <a href="resources.html" class="sidebar-item">
          <i class="bi bi-folder"></i>
          <span>Resources</span>
        </a>
        <a href="discussion.html" class="sidebar-item">
          <i class="bi bi-chat-dots"></i>
          <span>Discussion Forum</span>
        </a>
        <a href="report.html" class="sidebar-item active" aria-current="page">
          <i class="bi bi-flag"></i>
          <span>My Reports</span>
        </a>
        <!-- Admin Panel Link (only visible to admins) -->
        <a
          href="../../admin/index.html"
          id="adminPanelLink"
          class="sidebar-item admin-item"
          style="display: none"
        >
          <i class="bi bi-shield-check"></i>
          <span>Admin Panel</span>
        </a>
      </nav>
      <div class="sidebar-footer">
        <div
          class="user-info"
          style="cursor: pointer; transition: all 0.3s ease"
        >
          <div class="user-avatar" id="sidebarAvatar"></div>
          <div>
            <div style="font-weight: bold; font-size: 14px" id="sidebarName">
              Loading...
            </div>
            <div style="font-size: 12px; opacity: 0.8" id="sidebarCourse">
              Loading...
            </div>
          </div>
        </div>
        <button id="logoutBtn" class="logout-btn">
          <i class="bi bi-box-arrow-right"></i>
          Logout
        </button>
      </div>
    </div>
    <!-- Main Content -->
    <div class="main-content" id="mainContent">
      <div class="top-nav">
        <div class="nav-left">
          <button
            class="menu-toggle"
            id="menuToggle"
            aria-label="Toggle sidebar"
          >
            <i class="bi bi-list"></i>
          </button>
          <h1 class="page-title">My Reports</h1>
        </div>
        <div class="nav-right">
          <button
            class="theme-toggle"
            id="themeToggle"
            aria-label="Toggle theme"
          >
            <i class="bi bi-moon"></i>
          </button>
        </div>
      </div>
      <div class="report-content">
        <div class="content-row">
          <!-- Main Section - My Reports History -->
          <div class="main-section" style="flex: 1">
            <div class="reports-container">
              <div class="reports-header">
                <h2 class="section-title">
                  <i class="bi bi-flag"></i>
                  My Reports History
                </h2>
                <p class="reports-subtitle">
                  View the status and details of all reports you've submitted.
                  To submit a new report, use the report option available in
                  Study Rooms or Discussion Forum.
                </p>
              </div>

              <!-- Filter/Sort Controls -->
              <div class="reports-controls">
                <div class="filter-group">
                  <label for="statusFilter">Status:</label>
                  <select id="statusFilter" class="form-select-sm">
                    <option value="all">All</option>
                    <option value="pending">Pending</option>
                    <option value="in_review">In Review</option>
                    <option value="resolved">Resolved</option>
                    <option value="dismissed">Dismissed</option>
                  </select>
                </div>
                <div class="filter-group">
                  <label for="sortOrder">Sort by:</label>
                  <select id="sortOrder" class="form-select-sm">
                    <option value="newest">Newest First</option>
                    <option value="oldest">Oldest First</option>
                  </select>
                </div>
              </div>

              <!-- Reports List -->
              <div class="reports-list" id="reportsList">
                <!-- Reports will be dynamically rendered here -->
                <div class="reports-loading">
                  <i class="bi bi-arrow-repeat spin"></i>
                  Loading your reports...
                </div>
              </div>

              <!-- Empty State -->
              <div
                class="reports-empty"
                id="reportsEmpty"
                style="display: none"
              >
                <div class="empty-icon">
                  <i class="bi bi-flag"></i>
                </div>
                <h3>No Reports Yet</h3>
                <p>
                  You haven't submitted any reports. If you encounter any
                  violations, you can report them directly from:
                </p>
                <ul class="report-locations">
                  <li>
                    <i class="bi bi-door-open"></i> Study Rooms - Report
                    participants via the 3-dot menu
                  </li>
                  <li>
                    <i class="bi bi-chat-dots"></i> Discussion Forum - Report
                    topics, posts, or comments
                  </li>
                </ul>
              </div>
            </div>
          </div>

          <!-- Side Section - Guidelines -->
          <div class="side-section">
            <div class="report-guidelines">
              <h3 class="section-title">
                <i class="bi bi-info-circle"></i>
                How to Report
              </h3>
              <div class="guideline-item">
                <i class="bi bi-door-open guideline-icon"></i>
                <div class="guideline-text">
                  <div class="guideline-title">In Study Rooms</div>
                  Click the 3-dot menu next to a participant's name to report
                  them.
                </div>
              </div>
              <div class="guideline-item">
                <i class="bi bi-chat-text guideline-icon"></i>
                <div class="guideline-text">
                  <div class="guideline-title">In Discussion Forum</div>
                  Use the report button on topics, posts, or comments.
                </div>
              </div>
              <div class="guideline-item">
                <i class="bi bi-shield-check guideline-icon"></i>
                <div class="guideline-text">
                  <div class="guideline-title">What Gets Reported</div>
                  The system automatically captures who, where, and when.
                </div>
              </div>
              <div class="guideline-item">
                <i class="bi bi-clock guideline-icon"></i>
                <div class="guideline-text">
                  <div class="guideline-title">Response Time</div>
                  Reports are reviewed within 24-48 hours.
                </div>
              </div>
            </div>

            <!-- Stats Summary -->
            <div class="reports-summary">
              <h3 class="section-title">
                <i class="bi bi-bar-chart"></i>
                Summary
              </h3>
              <div class="summary-stats" id="summaryStats">
                <div class="stat-item">
                  <span class="stat-value" id="totalReports">0</span>
                  <span class="stat-label">Total Reports</span>
                </div>
                <div class="stat-item">
                  <span class="stat-value pending" id="pendingReports">0</span>
                  <span class="stat-label">Pending</span>
                </div>
                <div class="stat-item">
                  <span class="stat-value resolved" id="resolvedReports"
                    >0</span
                  >
                  <span class="stat-label">Resolved</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Report Detail Modal -->
    <div id="reportDetailModal" class="modal-overlay" style="display: none">
      <div class="modal-content" style="max-width: 600px; width: 95%">
        <div
          class="modal-header"
          style="
            display: flex;
            justify-content: space-between;
            align-items: center;
          "
        >
          <h3 style="margin: 0">Report Details</h3>
          <button
            type="button"
            onclick="closeReportDetailModal()"
            style="
              background: none;
              border: none;
              font-size: 28px;
              line-height: 1;
            "
          >
            &times;
          </button>
        </div>
        <div
          class="modal-body"
          id="reportDetailContent"
          style="padding-top: 12px"
        >
          <!-- Report details will be rendered here -->
        </div>
      </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>

    <!-- Use modular firebase config used throughout the project -->
    <script type="module" src="../../config/firebase.js"></script>

    <!-- IMPORTANT: load centralized sidebar BEFORE page script so sidebar is initialized first -->
    <script type="module" src="../scripts/sidebar.js"></script>
    <script type="module" src="../scripts/report.js"></script>
  </body>
</html>
