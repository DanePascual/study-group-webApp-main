<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Bootstrap and icons -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.0/font/bootstrap-icons.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../styles/report.css" />
    <title>Report - Study Group</title>
  </head>
  <body>
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-brand">
          <i class="bi bi-book"></i>
          StudyGroup
        </div>
      </div>
      <nav class="sidebar-menu" role="navigation">
        <a href="dashboard.html" class="sidebar-item">
          <i class="bi bi-house"></i>
          <span>Dashboard</span>
        </a>
        <a href="profile.html" class="sidebar-item">
          <i class="bi bi-person"></i>
          <span>Profile</span>
        </a>
        <a href="study-rooms.html" class="sidebar-item">
          <i class="bi bi-door-open"></i>
          <span>Study Rooms</span>
        </a>
        <a href="resources.html" class="sidebar-item">
          <i class="bi bi-folder"></i>
          <span>Resources</span>
        </a>
        <a href="discussion.html" class="sidebar-item">
          <i class="bi bi-chat-dots"></i>
          <span>Discussion Forum</span>
        </a>
        <a href="report.html" class="sidebar-item active" aria-current="page">
          <i class="bi bi-flag"></i>
          <span>Report</span>
        </a>
        <!-- Admin Panel Link (only visible to admins) -->
        <a
          href="../../admin/index.html"
          id="adminPanelLink"
          class="sidebar-item admin-item"
          style="display: none"
        >
          <i class="bi bi-shield-check"></i>
          <span>Admin Panel</span>
        </a>
      </nav>
      <div class="sidebar-footer">
        <div
          class="user-info"
          style="cursor: pointer; transition: all 0.3s ease"
        >
          <div class="user-avatar" id="sidebarAvatar"></div>
          <div>
            <div style="font-weight: bold; font-size: 14px" id="sidebarName">
              Loading...
            </div>
            <div style="font-size: 12px; opacity: 0.8" id="sidebarCourse">
              Loading...
            </div>
          </div>
        </div>
        <button id="logoutBtn" class="logout-btn">
          <i class="bi bi-box-arrow-right"></i>
          Logout
        </button>
      </div>
    </div>
    <!-- Main Content -->
    <div class="main-content" id="mainContent">
      <div class="top-nav">
        <div class="nav-left">
          <button
            class="menu-toggle"
            id="menuToggle"
            aria-label="Toggle sidebar"
          >
            <i class="bi bi-list"></i>
          </button>
          <h1 class="page-title">Report a Violation</h1>
        </div>
        <div class="nav-right">
          <button
            class="theme-toggle"
            id="themeToggle"
            aria-label="Toggle theme"
          >
            <i class="bi bi-moon"></i>
          </button>
        </div>
      </div>
      <div class="report-content">
        <div class="content-row">
          <!-- Main Section -->
          <div class="main-section">
            <div class="report-form">
              <h2 class="section-title">
                <i class="bi bi-exclamation-triangle"></i>
                Submit a Report
              </h2>
              <form id="reportForm">
                <!-- Report Type -->
                <div class="form-group">
                  <label class="form-label" for="reportType">
                    Report Type
                    <span style="color: var(--danger-color)">*</span>
                  </label>
                  <select class="form-select" id="reportType" required>
                    <option value="">Select Report Type</option>
                    <option value="harassment">Harassment/Bullying</option>
                    <option value="inappropriate">Inappropriate Content</option>
                    <option value="cheating">
                      Academic Dishonesty/Cheating
                    </option>
                    <option value="spam">Spam/Off-topic Content</option>
                    <option value="privacy">Privacy Violation</option>
                    <option value="threat">Threats/Violence</option>
                    <option value="impersonation">Impersonation</option>
                    <option value="other">Other Violation</option>
                  </select>
                </div>
                <!-- Severity Level -->
                <div class="form-group">
                  <label class="form-label" for="severity">
                    Severity Level
                    <span style="color: var(--danger-color)">*</span>
                  </label>
                  <select class="form-select" id="severity" required>
                    <option value="">Select Severity</option>
                    <option value="low">Low - Minor rule violation</option>
                    <option value="medium">Medium - Disruptive behavior</option>
                    <option value="high">
                      High - Harmful content/behavior
                    </option>
                    <option value="critical">
                      Critical - Threats/serious violations
                    </option>
                  </select>
                </div>
                <!-- Who are you reporting -->
                <div class="form-group">
                  <label class="form-label" for="reportedUser">
                    Who are you reporting?
                    <span style="color: var(--danger-color)">*</span>
                  </label>
                  <input
                    type="text"
                    class="form-input"
                    id="reportedUser"
                    placeholder="Type username or email..."
                    required
                  />
                  <div
                    id="userSuggestions"
                    class="user-suggestions"
                    style="display: none"
                  ></div>
                </div>
                <!-- Where did it happen -->
                <div class="form-group">
                  <label class="form-label" for="location">
                    Where did it happen?
                    <span style="color: var(--danger-color)">*</span>
                  </label>
                  <input
                    type="text"
                    class="form-input"
                    id="location"
                    placeholder='e.g., "CS Study Room chat" or "Discussion Forum"'
                    required
                  />
                </div>
                <!-- When did it happen -->
                <div class="form-group">
                  <label class="form-label" for="incidentTime">
                    When did it happen?
                  </label>
                  <input
                    type="datetime-local"
                    class="form-input"
                    id="incidentTime"
                  />
                </div>
                <!-- Description -->
                <div class="form-group">
                  <label class="form-label" for="description">
                    Describe the issue
                    <span style="color: var(--danger-color)">*</span>
                  </label>
                  <textarea
                    class="form-textarea"
                    id="description"
                    placeholder="Please provide a detailed description of what happened. Include specific examples if possible..."
                    required
                    maxlength="1000"
                  ></textarea>
                  <div
                    style="
                      text-align: right;
                      font-size: 12px;
                      color: var(--medium-text);
                      margin-top: 5px;
                    "
                  >
                    <span id="charCount">0</span>/1000 characters
                  </div>
                </div>
                <!-- Evidence Upload -->
                <div class="form-group">
                  <label class="form-label"> Attach Evidence (Optional) </label>
                  <div class="upload-area" id="uploadArea">
                    <div class="upload-icon">
                      <i class="bi bi-cloud-upload"></i>
                    </div>
                    <div class="upload-text">
                      Drag and drop files here or click to upload
                    </div>
                    <div class="upload-subtext">
                      Screenshots, chat logs, or other evidence (Max 5MB per
                      file)
                    </div>
                    <button type="button" class="upload-btn" id="uploadBtn">
                      <i class="bi bi-plus"></i> Choose Files
                    </button>
                    <input
                      type="file"
                      id="fileInput"
                      multiple
                      accept="image/*,.pdf,.txt"
                      style="display: none"
                    />
                  </div>
                  <div class="uploaded-files" id="uploadedFiles"></div>
                </div>
                <!-- Submit Section -->
                <div class="submit-section">
                  <button
                    type="button"
                    class="cancel-btn"
                    onclick="resetForm()"
                  >
                    <i class="bi bi-x"></i> Cancel
                  </button>
                  <button type="submit" class="submit-btn">
                    <i class="bi bi-send"></i> Submit Report
                  </button>
                </div>
              </form>
            </div>
          </div>
          <!-- Side Section -->
          <div class="side-section">
            <div class="report-guidelines">
              <h3 class="section-title">
                <i class="bi bi-info-circle"></i>
                Reporting Guidelines
              </h3>
              <div class="guideline-item">
                <i class="bi bi-check-circle guideline-icon"></i>
                <div class="guideline-text">
                  <div class="guideline-title">Be Specific</div>
                  Provide clear details about what happened and when.
                </div>
              </div>
              <div class="guideline-item">
                <i class="bi bi-camera guideline-icon"></i>
                <div class="guideline-text">
                  <div class="guideline-title">Include Evidence</div>
                  Screenshots or chat logs help us understand the situation.
                </div>
              </div>
              <div class="guideline-item">
                <i class="bi bi-shield-check guideline-icon"></i>
                <div class="guideline-text">
                  <div class="guideline-title">Stay Safe</div>
                  Report threats or harassment immediately.
                </div>
              </div>
              <div class="guideline-item">
                <i class="bi bi-exclamation-triangle guideline-icon"></i>
                <div class="guideline-text">
                  <div class="guideline-title">No False Reports</div>
                  False reporting may result in account restrictions.
                </div>
              </div>
              <div class="guideline-item">
                <i class="bi bi-clock guideline-icon"></i>
                <div class="guideline-text">
                  <div class="guideline-title">Response Time</div>
                  We review reports within 24-48 hours.
                </div>
              </div>
            </div>
            <div class="report-status">
              <h3 class="section-title">
                <i class="bi bi-list-check"></i>
                Your Recent Reports
              </h3>
              <!-- This section will be dynamically replaced by JS -->
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Success Modal -->
    <div id="successModal" class="modal-overlay" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Report Submitted Successfully</h3>
        </div>
        <div class="modal-body">
          <div style="text-align: center; margin: 20px 0">
            <i
              class="bi bi-check-circle"
              style="font-size: 48px; color: var(--primary-color)"
            ></i>
          </div>
          <p>
            Your report has been submitted and assigned ID:
            <strong id="reportId"></strong>
          </p>
          <p>
            We'll review your report within 24-48 hours and take appropriate
            action.
          </p>
          <p>You'll receive updates on the status of your report.</p>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="submit-btn"
            onclick="closeSuccessModal()"
          >
            OK
          </button>
        </div>
      </div>
    </div>
    <!-- MODAL FOR ALL REPORTS -->
    <div
      id="allReportsModal"
      class="modal-overlay"
      style="display: none; z-index: 3000"
    >
      <div
        class="modal-content"
        style="max-width: 600px; width: 95%; max-height: 80vh; overflow-y: auto"
      >
        <div
          class="modal-header"
          style="
            display: flex;
            justify-content: space-between;
            align-items: center;
          "
        >
          <h3 style="margin: 0">All My Reports</h3>
          <button
            type="button"
            onclick="closeAllReportsModal()"
            style="
              background: none;
              border: none;
              font-size: 28px;
              line-height: 1;
            "
          >
            &times;
          </button>
        </div>
        <div class="modal-body" id="allReportsList" style="padding-top: 12px">
          <!-- All reports will appear here -->
        </div>
      </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>

    <!-- Use modular firebase config used throughout the project -->
    <script type="module" src="../../config/firebase.js"></script>

    <!-- IMPORTANT: load centralized sidebar BEFORE page script so sidebar is initialized first -->
    <script type="module" src="../scripts/sidebar.js"></script>
    <script type="module" src="../scripts/report.js"></script>
  </body>
</html>
